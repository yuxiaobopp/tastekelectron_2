(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-222a5559"],{"386b":function(t,e,a){var o=a("5ca1"),l=a("79e5"),r=a("be13"),s=/"/g,i=function(t,e,a,o){var l=String(r(t)),i="<"+e;return""!==a&&(i+=" "+a+'="'+String(o).replace(s,"&quot;")+'"'),i+">"+l+"</"+e+">"};t.exports=function(t,e){var a={};a[t]=e(i),o(o.P+o.F*l(function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}),"String",a)}},"673e":function(t,e,a){"use strict";a("386b")("sub",function(t){return function(){return t(this,"sub","","")}})},"6b81":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("h1",[t._v("任务："+t._s(t.$route.params.task_name))]),a("p",[t._v("状态：")]),a("i-switch",{attrs:{disabled:""},model:{value:t.collect_status,callback:function(e){t.collect_status=e},expression:"collect_status"}},[a("span",{attrs:{slot:"open"},slot:"open"},[t._v("开")]),a("span",{attrs:{slot:"close"},slot:"close"},[t._v("关")])]),a("br"),a("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"md-add-circle"},on:{click:t.handleAdd}},[t._v("添加记录")]),a("Button",{staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.exportData(1)}}},[a("Icon",{attrs:{type:"ios-download-outline"}}),t._v("导出源数据")],1),a("Button",{staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.exportData(2)}}},[a("Icon",{attrs:{type:"ios-download-outline"}}),t._v("导出排序和过滤后的数据")],1),a("Divider"),a("Tabs",{attrs:{value:"name1"}},[a("TabPane",{attrs:{label:"Modbus通讯地址表",name:"name1"}},[a("v-subtasklist",{ref:"sub"})],1),a("TabPane",{attrs:{label:"标签二",name:"name2"}})],1),a("Modal",{attrs:{title:"Common Modal dialog box title",styles:{top:"0px"},draggable:""},model:{value:t.add_show,callback:function(e){t.add_show=e},expression:"add_show"}},[a("p",{attrs:{slot:"header"},slot:"header"},[t._v("添加记录")]),a("Card",{attrs:{"dis-hover":"",bordered:!1}},[a("Form",{ref:"reocrd",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-width":100}},[a("FormItem",{attrs:{label:"操作类型",prop:"modbus_function_code",number:""}},[a("Select",{staticStyle:{width:"330px"},model:{value:t.formValidate.modbus_function_code,callback:function(e){t.$set(t.formValidate,"modbus_function_code",e)},expression:"formValidate.modbus_function_code"}},t._l(t.modbus_func_list,function(e,o){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1)],1),a("FormItem",{attrs:{label:"选择设备",prop:"slave_id"}},[a("Select",{staticStyle:{width:"330px"},model:{value:t.formValidate.slave_id,callback:function(e){t.$set(t.formValidate,"slave_id",e)},expression:"formValidate.slave_id"}},t._l(t.device_list,function(e,o){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1)],1),a("FormItem",{attrs:{label:"起始地址",prop:"start_address"}},[a("Row",[a("Col",{attrs:{span:"18"}},[a("Input",{attrs:{placeholder:"寄存器或线圈地址",number:""},model:{value:t.formValidate.start_address,callback:function(e){t.$set(t.formValidate,"start_address",e)},expression:"formValidate.start_address"}})],1),a("Col",{attrs:{span:"4",offset:"1"}})],1)],1),a("FormItem",{attrs:{label:"结束地址",prop:"stop_address"}},[a("Row",[a("Col",{attrs:{span:"18"}},[a("Input",{attrs:{placeholder:"寄存器或线圈地址",number:""},model:{value:t.formValidate.stop_address,callback:function(e){t.$set(t.formValidate,"stop_address",e)},expression:"formValidate.stop_address"}})],1),a("Col",{attrs:{span:"4",offset:"1"}},[a("Button",{on:{click:function(e){t.show_attribute=!0}}},[t._v("详细配置>>")])],1)],1)],1),a("FormItem",{attrs:{label:"原始数据类型",prop:"data_length",number:""}},[a("Select",{staticStyle:{width:"330px"},model:{value:t.formValidate.data_length,callback:function(e){t.$set(t.formValidate,"data_length",e)},expression:"formValidate.data_length"}},t._l(t.data_size_list,function(e,o){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1)],1),a("FormItem",{attrs:{label:"缩放因子",prop:"scale",number:""}},[a("Input",{model:{value:t.formValidate.scale,callback:function(e){t.$set(t.formValidate,"scale",e)},expression:"formValidate.scale"}})],1),a("FormItem",{attrs:{label:"采集间隔（秒）",prop:"interval",number:""}},[a("Input",{model:{value:t.formValidate.interval,callback:function(e){t.$set(t.formValidate,"interval",e)},expression:"formValidate.interval"}})],1),a("FormItem",{attrs:{label:"数据上报方式",prop:"send_way"}},[a("RadioGroup",{model:{value:t.formValidate.send_way,callback:function(e){t.$set(t.formValidate,"send_way",e)},expression:"formValidate.send_way"}},[a("Radio",{attrs:{label:"time"}},[t._v("按时上报")]),a("Radio",{attrs:{label:"change"}},[t._v("变更上报")])],1)],1),a("Button",{attrs:{type:"primary"},on:{click:t.go_forward}},[t._v("\n                  高级选项\n                  "),a("Icon",{attrs:{type:"ios-arrow-forward"}})],1)],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[t.edit?a("Button",{attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit("reocrd")}}},[t._v("确认修改")]):t._e(),t.edit?a("Button",{attrs:{type:"primary"},on:{click:function(e){t.show=!1}}},[t._v("取消")]):t._e(),t.edit?t._e():a("Button",{attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit("reocrd")}}},[t._v("确定")]),t.edit?t._e():a("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(e){return t.handleReset("reocrd")}}},[t._v("重置")])],1)],1),a("Modal",{attrs:{title:"Common Modal dialog box title",draggable:""},model:{value:t.show_high,callback:function(e){t.show_high=e},expression:"show_high"}},[a("p",{attrs:{slot:"header"},slot:"header"},[t._v("高级选项")]),a("Card",{attrs:{"dis-hover":"",bordered:!1}},[a("Form",{ref:"formValidate",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-width":100}},[a("FormItem",{attrs:{label:"量程上限",prop:"top_limit",number:""}},[a("Input",{attrs:{placeholder:"输入量程上限"},model:{value:t.formValidate.top_limit,callback:function(e){t.$set(t.formValidate,"top_limit",e)},expression:"formValidate.top_limit"}})],1),a("FormItem",{attrs:{label:"量程下限",prop:"low_limit",number:""}},[a("Input",{attrs:{placeholder:"输入量程下限"},model:{value:t.formValidate.low_limit,callback:function(e){t.$set(t.formValidate,"low_limit",e)},expression:"formValidate.low_limit"}})],1),a("Poptip",{attrs:{trigger:"hover",title:"提示","word-wrap":"",width:"300",content:"可以自定义一个公式来计算最终希望得到的数据，公式中用X代表原始二进制数据解析后的值。"}},[a("FormItem",{attrs:{label:"计算公式",prop:"compute"}},[a("Input",{attrs:{type:"textarea",rows:4},model:{value:t.formValidate.compute,callback:function(e){t.$set(t.formValidate,"compute",e)},expression:"formValidate.compute"}})],1)],1)],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary"},on:{click:t.go_back}},[t._v("确定并返回")])],1)],1),a("v-addAttribute",{attrs:{show_attribute:t.show_attribute}})],1)},l=[],r=(a("673e"),a("7f7f"),a("66df")),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Table",{ref:"recordTable",attrs:{columns:t.recordColumns,data:t.recordList,stripe:""}}),a("Modal",{attrs:{width:"360"},model:{value:t.del_confirm,callback:function(e){t.del_confirm=e},expression:"del_confirm"}},[a("p",{staticStyle:{color:"#f60","text-align":"center"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"ios-information-circle"}}),a("span",[t._v("Delete confirmation")])],1),a("div",{staticStyle:{"text-align":"center"}},[a("p",[t._v("确定删除？")]),a("p",[t._v("Will you delete it?")])]),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"error",size:"large",long:""}},[t._v("Delete")])],1)])],1)},i=[],n={name:"sub_task_list",data:function(){var t=this;return{del_confirm:!1,recordList:[],recordColumns:[{title:"Slave",key:"slave_id",width:120,sortable:!0},{title:"数据描述",key:"function_name",width:120},{title:"标识符",key:"identifier",width:120,sortable:!0},{title:"采集地址",key:"start_address",width:120,sortable:!0},{title:"状态",key:"active_status",width:120,render:function(t,e){return"true"==e.row.active_status?t("div",["on",t("i-switch",{props:{disabled:!0,value:!0}})]):t("div",["off",t("i-switch",{props:{disabled:!0,value:!1}})])}},{title:"功能码",key:"modbus_function_code",width:80,sortable:!0},{title:"数据长度",key:"data_length",width:120},{title:"计算公式",key:"compute",width:120,sortable:!0},{title:"发送方式",key:"send_way",width:120,sortable:!0},{title:"操作",key:"aa",align:"center",render:function(e,a){return e("div",[e("a",{style:{marginLeft:"0px"},on:{click:function(){t.chnge_status(a.row.slave_id,a.row.start_address),"false"==a.row.active_status?a.row.active_status="true":a.row.active_status="false"}}},"切换状态 / "),e("a",{props:{},style:{marginLeft:"0px"},on:{click:function(){console.log("111111111")}}},"编辑 /"),e("a",{style:{marginLeft:"0px"},on:{click:function(){t.delateRecord(a.row.slave_id,a.row.start_address)}}}," 删除")])}}]}},methods:{get_all_record:function(){var t=this;r["a"].request({url:"api/task/getAllRecord"}).then(function(e){console.log(e.data),"ok"==e.data.msg&&(t.recordList=e.data.data)}).catch(function(t){console.log("get all record fail"),console.log(t)})},chnge_status:function(t,e){var a=this;r["a"].request({url:"api/task/changeStatus",method:"post",data:{slave_id:t,start_address:e}}).then(function(t){console.log(t.data),"ok"==t.data.msg&&a.get_all_record()}).catch(function(t){console.log(t)})},delateRecord:function(t,e){var a=this;r["a"].request({url:"api/task/deleteRecord",method:"post",data:{slave_id:t,start_address:e}}).then(function(t){console.log(t.data),"ok"==t.data.msg&&a.get_all_record()}).catch(function(t){console.log(t)})}},mounted:function(){console.log("sub_task_record"),this.get_all_record()}},d=n,c=a("2877"),u=Object(c["a"])(d,s,i,!1,null,null,null),f=u.exports,m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Drawer",{attrs:{title:"Basic Drawer","mask-closable":!1,width:"500"},model:{value:t.show_attribute,callback:function(e){t.show_attribute=e},expression:"show_attribute"}},[a("Transfer",{attrs:{data:t.attribute,"target-keys":t.targetKeys1,"render-format":t.render1,filterable:"","filter-method":t.filterMethod,titles:["未添加","已添加"]},on:{"on-change":t.handleChange1}},[a("div",{style:{float:"right",margin:"5px"}},[a("Button",{attrs:{size:"small"},on:{click:t.confirm}},[t._v("确定")])],1)])],1)},_=[],p=a("75fc"),h={name:"addAttribute",props:["show_attribute"],data:function(){return{attribute:[],targetKeys1:[]}},methods:{render1:function(t){return t.label},handleChange1:function(t,e,a){var o;if("right"==e)(o=this.targetKeys1).push.apply(o,Object(p["a"])(a));else for(var l in a){var r=this.targetKeys1.indexOf(a[l]);this.targetKeys1.splice(r,1)}},confirm:function(){for(var t in console.log(this.$parent.show_attribute),this.$parent.formValidate.identifier=this.targetKeys1,this.attribute)-1!=this.targetKeys1.indexOf(this.attribute[t].key)&&this.$parent.formValidate.function_name.push(this.attribute[t].label);console.log("穿梭框："),console.log(this.$parent.formValidate.identifier),console.log(this.$parent.formValidate.function_name),this.$parent.show_attribute=!1},getAttribute:function(){var t=this;r["a"].request({url:"api/device/getAttribute"}).then(function(e){"ok"==e.data.msg?t.attribute=e.data.data:t.$Message.success("获取属性表失败！")}).catch(function(t){console.log(t)})},filterMethod:function(t,e){return t.label.indexOf(e)>-1}},mounted:function(){this.getAttribute(),console.log(this.$parent.show_attribute),console.log(this.attribute)}},b=h,v=Object(c["a"])(b,m,_,!1,null,null,null),g=v.exports,w={name:"sub_task",props:["collect_status"],components:{"v-subtasklist":f,"v-addAttribute":g},data:function(){var t=function(t,e,a){e-=0,isNaN(e)?a(new Error("请输入一个整数！")):a()};return{attribute:[],edit:!1,add_show:!1,show_high:!1,show_attribute:!1,device_list:[],formValidate:{gateway:this.$route.query.gateway,slave_id:1,start_address:null,stop_address:null,function_name:[],modbus_function_code:3,identifier:[],data_length:16,top_limit:-1,low_limit:-1,scale:1,interval:5,send_way:"time",compute:""},ruleValidate:{start_address:[{required:!0,validator:t,trigger:"blur"}],stop_address:[{required:!0,validator:t,trigger:"blur"}]},send_way_list:[{value:"time",label:"按时上报"},{value:"change",label:"变更上报"}],modbus_func_list:[{value:1,label:"线圈状态 (只读，01)"},{value:2,label:"离散量输入 (只读，02)"},{value:3,label:"保持寄存器 (只读，03)"},{value:4,label:"输入寄存器 (只读，04)"},{value:5,label:"线圈状态 (读写，读取使用01，写入使用05)"},{value:6,label:"保持寄存器 (读写，读取使用03，写入使用06)"},{value:7,label:"线圈状态 (读写，读取使用01，写入使用0F)"},{value:8,label:"保持寄存器 (读写，读取使用03，写入使用10)"}],data_size_list:[{value:1,label:1},{value:8,label:8},{value:16,label:16},{value:32,label:32}]}},methods:{handleAdd:function(){this.add_show=!0,this.formValidate.function_name=[],this.formValidate.identifier=[]},go_forward:function(){this.add_show=!1,this.show_high=!0},go_back:function(){this.show_high=!1,this.add_show=!0},getAlldevice:function(){var t=this;r["a"].request({url:"api/device/getAll",methods:"post",data:{gateway_name:this.$route.query.gateway}}).then(function(e){if("ok"==e.data.msg){var a=e.data.data;for(var o in a)t.device_list.push({value:a[o]["slave"],label:a[o]["name"]});console.log("device: ",t.device_list)}else t.$Message.success("获取设备信息失败！")}).catch(function(t){console.log(t)})},handleSubmit:function(t){var e=this;this.$refs[t].validate(function(t){if(t){if(console.log(e.formValidate),e.formValidate.function_name.length!=e.formValidate.stop_address-e.formValidate.start_address+1)return void e.$Notice.error({title:"Note:",desc:"地址数与标识符数目无法对应！"});r["a"].request({url:"api/task/addRecord",method:"post",data:e.formValidate}).then(function(t){console.log(t.data),"ok"==t.data.msg?(e.add_show=!1,e.$refs.sub.get_all_record(),e.$Notice.success({title:"Note:",desc:"成功"})):e.$Notice.error({title:"Note:",desc:"创建失败！"})}).catch(function(t){console.log(t)})}else e.$Message.error("请填写正确参数!")})},exportData:function(t){},handleReset:function(t){this.$refs[t].resetFields()}},mounted:function(){console.log(this.$route.params),console.log(this.$route.query),this.getAlldevice()}},y=w,k=Object(c["a"])(y,o,l,!1,null,null,null);e["default"]=k.exports}}]);